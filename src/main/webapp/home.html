<!DOCTYPE html>
<html>
<head>
    <title>Leave the House Out of It!</title>
    <style> table, th, td {border: 1px solid black;}
</style>
</head>
<body>
 
    <table style="width:100%">
    	<tr>
    		<td style="width:80%" align="center">
       			Welcome to the Football Gambling App That Doesn't Have a House!
       		</td>
       		<td style="width:20%"><div id="greeting">
       			<form action="javascript:void(0);">
         			<div><input id="loginButton" type="submit" value="Login"></div>
   				</form>
   				<div id="greetingtext"></div>
       		</div></td>
    	</tr>
    	<tr>
    		<td><div id="content">    			
    			<div id="result"></div>
   				<div id="debug"></div>	
    		</div></td>
    		<td>Right Side Bar</td>
    	</tr>
    </table>
    
    <script type="text/javascript">
       	var scopes = 'https://www.googleapis.com/auth/userinfo.email';
    	var client_id = '212370171378-ap7khd2mnqd3ogd1bskkgfdm0ql270eo.apps.googleusercontent.com';

    	function signin(mode, callback) 
    	{
    	  	gapi.auth.authorize({client_id: client_id,scope: scopes, immediate: mode},callback);
    	}
    
    
    	function init() 
        {
                //Parameters are APIName,APIVersion,CallBack function,API Root 
                gapi.client.load('leagueadmin', 'v1', null, 'https://focal-acronym-94611.appspot.com/_ah/api');
                
                
                var apisToLoad;
            	var callback = function() 
            	{
            	   if (--apisToLoad == 0) 
            	   {
            	     signin(true, showhandle);
            	   }
            	}
            	  
            	apisToLoad = 2;
            	//Parameters are APIName,APIVersion,CallBack function,API Root 
            	gapi.client.load('leagueadmin', 'v1', callback, 'https://focal-acronym-94611.appspot.com/_ah/api');
            	gapi.client.load('oauth2','v2',callback);
                
                
                document.getElementById('loginButton').onclick = function() 
                {
                	signin(false,showhandle);
                }
        }
        
        
        
    	//This function is called automatically when initializing the page or if the user pushes the login button.
    	//If the user is successfuly logged in than this function will use their email to fetch their handle and display it in the window.
      	//If the user is not logged in it will instead display the login button.
      	//If the user is logged in, but does not have an entry in the table it will show an error.
      	function showhandle() 
        {
      		var addy = "";
    		
    		//If the user is logged in take away the login button and add the user's handle in the welcome area.
    		var request = gapi.client.oauth2.userinfo.get().execute(function(resp)
      		{
      		   	if (!resp.code)
      		   	{
      		   		// User is signed in, so hide the button
      		   		document.getElementById('loginButton').style.visibility = 'hidden';
      		   		getHandleFromAPI(resp.email)  		
      		   	}
      		   	else 
      		   	{
      		   		document.getElementById('loginButton').style.visibility = '';
      		   	}
      		});

        }
    	
    	
    	function getHandleFromAPI(addy)
    	{
    		try
           	{
    			//Build the Request Object
                var requestData = {};
                requestData.email = addy;
                gapi.client.leagueadmin.getUser(requestData).execute(function(resp)  
        		{		
        			if (!resp.code) 
	               	{
    	    			resp.items = resp.items || [];
	    	   			
    	    			for (var i=0;i<resp.items.length;i++)
		       			{
		       				result_handle = resp.items[i].handle;
		       				
	                   	}
    	        	    
    	    			document.getElementById('greetingtext').innerText = 'Logged In As: ' + result_handle;
	               	}
    	    		else
        			{
    	    			document.getElementById('greetingtext').innerText = 'Error: Nothing in Result Set';
        			}
        		});
           	}
          	catch(err)
          	{
          		return "Error: Error with Result Set.";
          	}
    	}
        
    </script>
    <script src="https://apis.google.com/js/client.js?onload=init"></script>
    
    
</body>
</html>